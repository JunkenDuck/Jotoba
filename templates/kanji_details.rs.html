@use crate::search::kanji::result::Item;
@(kanji: Vec<Item>)
<!-- Inner Main Body -->
@for (kpos, k_item) in kanji.iter().enumerate() {
  @if kpos > 0 {
    <br>
  }
  <div class="d-flex">
      <!-- Left side: Kanji -->
      <div class="kanji-entry left detail d-flex flex-column">
         <span class="kanji-preview x-large">
           @k_item.kanji.kanji.literal
         </span>
         <div class="kanji-preview-info">
           <div class="notes"><b>@k_item.kanji.kanji.stroke_count</b> strokes </div>
            <!--TODO-->
            <div class="notes"><b>Radical:</b>
              <br>
              <a class="clickable no-align" href="/search?type=1&search=@k_item.radical.literal">@k_item.get_radical()</a>
              @if k_item.get_rad_len() > 7 {
                <br>
              }
              @if let Some(ref translations) = k_item.radical.translations {
                (@translations.join(", "))
              }
            </div>
            @if let Some(ref parts) = k_item.parts {
              <div class="notes"><b>@k_item.get_parts_title():</b>
                <br>
                @for (pos, part) in parts.iter().enumerate() {
                  @if pos > 0 {
                    <span class="tags no-margin fat">,</span>
                  }
                  <a class="clickable no-align" href="/search?type=1&search=@part">@part</a>
                }
              </div>
            }
         </div>
      </div>
      <!-- Right side: Info -->
      <div class="kanji-entry right detail">
         <!-- First Part -->
         <div class="kanji-entry d-flex flex-row">
            <!-- Inner Left Side -->
            <div class="kanji-preview-left">
               <div class="translation big">
                   @k_item.kanji.meanings.join(", ")
               </div>
                @if let Some(ref kun_readings) = k_item.kanji.kanji.kunyomi {
                 <div class="d-flex flex-row wrap">
                    <div class="tags no-margin fat right-padding-10 noselect">Kun:</div>
                      @for (pos, kun) in kun_readings.iter().enumerate() {
                        @if pos > 0 {
                          <div class="tags no-margin fat right-padding-10">,</div>
                        }
                        <a class="clickable no-align fat" href="/search?type=0&search=@k_item.kanji.kanji.literal+@kun">@kun</a>
                      }
                 </div>
                }
                @if let Some(ref on_readings) = k_item.kanji.kanji.onyomi {
                 <div class="d-flex flex-row wrap">
                    <div class="tags no-margin fat right-padding-20 noselect">On:</div>
                      @for (pos, on) in on_readings.iter().enumerate() {
                        @if pos > 0 {
                          <div class="tags no-margin fat right-padding-10">,</div>
                        }
                        <a class="clickable no-align fat" href="/search?type=0&search=@k_item.kanji.kanji.literal+@on">@on</a>
                      }
                 </div>
               }
            </div>
            <!-- Inner Right Side -->
            <div class="kanji-preview-right">
                @if let Some(ref grade) = k_item.kanji.kanji.school_str() {
                 <div class="notes">@grade</div>
                }
                @if let Some(n_lvl) = k_item.kanji.kanji.jlpt {
                 <div class="notes">JLPT level <b>N@n_lvl</b></div>
                }
                @if let Some(frequency) = k_item.kanji.kanji.frequency {
                 <div class="notes"><b>@frequency</b> of 2500 most used kanji in newspapers</div>
                }
            </div>
        </div>
        <!-- Alternative Readings Part -->
        <div>
          @if let Some(ref natori) = k_item.kanji.kanji.natori {
            <div class="notes d-flex flex-row wrap"><b class="right-padding-10">Japanese names:</b> 
              @for (pos, n) in natori.iter().enumerate() {
                @if pos > 0 {
                  <div class="tags no-margin slim right-padding-10">,</div>
                }
                <a class="clickable no-align" href="/search?type=3&search=@k_item.kanji.kanji.literal+@n">@n</a>
              }
            </div>
          }
          @if let Some(ref chinese) = k_item.kanji.kanji.chinese {
            <div class="notes"><b>Chinese reading:</b> @chinese.join(", ")</div>
          }
          @if let Some(ref korean) = k_item.get_korean() {
            <div class="notes"><b>Korean reading:</b>&nbsp;&nbsp; @korean.join(", ")</div>
          }
        </div>

         <!-- Second Part -->
         @if k_item.has_stroke_frames() {
           <hr/>
           <div class="stroke-container">
                <img src="@k_item.get_stroke_frames_url()">
           </div>
         }
         @if k_item.has_animation_file() {
           <div class="animation-container d-flex flex-row">
              <div class="d-flex flex-column slider-parent">
                 <div class="slidecontainer">
                    <input type="range" min="0.05" max="2" value="1" step="0.05" class="slider speedSlider">
                 </div>
                 <span class="slider-output noselect currentAnimationSpeed">Animation speed: 1</span>
              </div>
              <div class="kanjisvgParent">
                <svg class="kanjisvg" width="109px" height="109px">
                @for (del, d) in k_item.get_animation_entries() {
                  <path style="animation-delay: @del;" class="draw2" stroke-linejoin="round" stroke="black" fill="none" stroke-width="5" d="@d">
                  </path>  
                }
                </svg>
              </div>
           </div>
         }
         <hr/>
         <!-- Reading Compounds -->
         <div class="kanji-entry d-flex flex-row">
            <!-- On Reading -->
            @if let Some(ref ons) = k_item.on_dicts {
              <div class="on-reading">
                 <h3 class="noselect">
                    On reading compounds
                 </h3>
                 <div class="d-flex flex-column">
                   @for on in ons.iter() {
                      <span>
                        @if let Some(ref kanji_reading) = on.reading.kanji {
                          <a class="clickable green" href="/search?type=0&search=@kanji_reading.reading">@kanji_reading.reading</a> 【@on.reading.kana.as_ref().unwrap().reading】@on.glosses_pretty()
                        }
                      </span>
                    }
                 </div>
              </div>
            }
            <!-- Kun Reading -->
            @if let Some(ref kuns) = k_item.kun_dicts {
              <div class="kun-reading">
                <h3 class="noselect">
                   Kun reading compounds
                </h3>
                <div class="d-flex flex-column">
                  @for kun in kuns.iter() {
                    <span>
                      @if let Some(ref kanji_reading) = kun.reading.kanji {
                        <a class="clickable green" href="/search?type=0&search=@kanji_reading.reading">@kanji_reading.reading</a> 【@kun.reading.kana.as_ref().unwrap().reading】@kun.glosses_pretty()
                      }
                    </span>
                  }
                </div>
              </div>
            }
         </div>
      </div>
   </div>

   <!-- Load this page's script -->
   <script src="assets/js/kanjiAnimation.js"></script>
}
